name: Comment beta preview links on PR open

on:
  pull_request:
    types: [opened, synchronize, reopened] # Listen for PR events

env:
  REPO_OWNER: razorpay
  REPO_NAME: docs
  BETA_PREVIEW_URL: https://betasite.razorpay.com/docs
  PR_NUMBER: ${{ github.event.number }}
  REGIONS: "IN,MY,SG"
jobs:
  comment_betapreviewlink_on_propen:
    name: Comment beta preview link on PR open
    runs-on: ubuntu-latest
    steps:
      - name: Prepare message with preview URLs
        id: prepare_message
        run: |
          message="# Preview URLSðŸ‘‡ðŸ»"
          for region in $(echo $REGIONS | tr ',' ' '); do
            message="$message\nRazorpay $region deployed at ${{ env.BETA_PREVIEW_URL }}/razorpay/$region/${{ github.head_ref }}"
          done
          echo "$message" > message.txt    
      
      - name: Comment on PR
        uses: thollander/actions-comment-pull-request@v2
        with:
          filePath: message.txt
          message: ${{ steps.prepare_message.outputs.message }}
          pr_number: ${{ github.event.number }}
