name: Comment beta preview links on PR open

on:
  pull_request:
    types: [opened, synchronize, reopened] # Listen for PR events

env:
  REPO_OWNER: razorpay
  REPO_NAME: docs
  BETA_PREVIEW_URL: https://betasite.razorpay.com/docs
  PR_NUMBER: ${{ github.event.number }}
  REGIONS: "IN,MY,SG"
jobs:
  comment_betapreviewlink_on_propen:
    name: Comment beta preview link on PR open
    runs-on: ubuntu-latest
    permissions:
      contents: write
      pull-requests: write
      repository-projects: write
    steps:
      - name: Prepare message with preview URLs
        id: prepare_message
        run: |
          message="# Preview URLSüëáüèª"
          for region in $(echo $REGIONS | tr ',' ' '); do
            message="$message Razorpay $region deployed at ${{ env.BETA_PREVIEW_URL }}/razorpay/$region/${{ github.head_ref }} /n"
          done

          message="${message} /n Axis IN deployed at ${{ env.BETA_PREVIEW_URL }}/axis/IN/${{ github.head_ref }}"
          
          echo "::set-output name=message::$message"   
      
      - name: Comment on PR
        uses: thollander/actions-comment-pull-request@v2
        with:
          filePath: message.txt
          message: ${{ steps.prepare_message.outputs.message }}
          pr_number: ${{ github.event.number }}
